---
title: Tomcat：组成
category: ['Tomcat']
tags: ['Tomcat']
author: 景阳
email: jyjsjd@hotmail.com
description: Tomcat
---

![tomcat.png](/assets/img/tomcat.png)

Tomcat 的核心组件是 `Connector` 和 `Container`。多个 Connector 和一个 Container 组成 `Service` 提供服务。

---

## Connector

Connector：监听特定端口号上的 TCP 请求，创建 `Request` 和 `Response` 对象用于处理请求数据和响应请求；每个请求都会产生一个对应线程来处理。

> A particular instance of this component listens for connections on a specific TCP port number on the server. Each incoming request requires a thread for the duration of that request.

### PipeLine

```java
public interface Pipeline {
    public Valve getBasic();
    public void setBasic(Valve valve);
    public void addValve(Valve valve);
    public Valve[] getValves();
    public void removeValve(Valve valve);
    public Valve getFirst();
    public boolean isAsyncSupported();
    public Container getContainer();
    public void setContainer(Container container);
}
```

### Valve

```java
public interface Valve {
    public String getInfo();
    public Valve getNext();
    public void setNext(Valve valve);
    public void backgroundProcess();
    public void invoke(Request request, Response response)
        throws IOException, ServletException;
    public void event(Request request, Response response, CometEvent event)
        throws IOException, ServletException;
    public boolean isAsyncSupported();
}
```

### ValveContext

### Contained

设置 container

```java
public interface Contained {
    public Container getContainer();
    public void setContainer(Container container);
}
```

### Mapper

---

## Container

Container：处理请求的线程。

> A container is a module that processes the requests for a servlet and populates the response objects for web clients.

- Engine
- Host
- Context
- Wrapper

---

## Context

Context 代表 Servlet 的 Context，它具备了 Servlet 运行的基本环境，理论上只要有 Context 就能运行 Servlet 了。简单的 Tomcat 可以没有 Engine 和 Host。

> can read and parse the default web.xml file.

---

## Host & Engine

### Host

> You use a host if you want to run more than one context in the same Tomcat deployment.

### Engine

> An engine represents the entire Catalina servlet engine. If used, an engine is always the top level container. Child containers added to an engine are normally implementations of org.apache.catalina.Host or org.apache.catalina.Context.

---

## Server & Service

### Server

> Server represents the entire Catalina servlet container and engulfs all other components. A server is particularly useful because it provides an elegant mechanism for starting and stopping the whole system. There is no need to start the connector and the container individually any longer.

### Service

多个 Connector 和一个 Container 构成一个 `Service`。

---

## 参考

[工作原理](<https://www.ibm.com/developerworks/cn/java/j-lo-tomcat1/index.html>)



[The HTTP Connector](<https://tomcat.apache.org/tomcat-8.5-doc/config/http.html>)